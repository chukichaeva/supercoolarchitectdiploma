# 000 Микросервисная архитектура
19.04.2022
## Контекст
Для популяризации и продвижения своей продукции менеджмент решает, что необходимо освоить новые каналы для информирования покупателей о выходе новых товаров и стимулировать спрос на новые вещи. 
Наше приложение должно стимулировать людей по всему миру соревноваться с собой и другими, повышая вовлечённость в здоровый образ жизни и повышая качество жизни. 
Необходимо выбрать один из архитектурных стилей для реализации задачи:

|                   |                                                                                       Agility                                                                                       |                                                                         Deployability                                                                         |                                                                      Evolvability                                                                      |                                                                                Fault Tolerance                                                                                |                                                                                                                     Performance                                                                                                                    |                                                                                                                       Testability                                                                                                                       |                                                                                    Cost                                                                                   |
|-------------------|:-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------:|:-------------------------------------------------------------------------------------------------------------------------------------------------------------:|:------------------------------------------------------------------------------------------------------------------------------------------------------:|:-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------:|:--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------:|:-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------:|:-------------------------------------------------------------------------------------------------------------------------------------------------------------------------:|
|      Монолит      |           Высокая связанность, но не только из-за сложности доработок, сколько из-за рисков, связанных с внесением изменений в систему - мы можем не знать, что зацепили           | Разворачивать монолит требуется в едином процесса на одном узле. База данных будет здесь же. Это является наиболее простым способом разворачивания системы.  |             Если приложение небольшое, то его эволюция не так сложна. Но чем больше приложение становится, тем сложнее его будет развивать            |                                                  Если служба выйдет из строя, вся система в монолитном ядре выйдет из строя                                                  |                                                                         Пользовательские службы и службы ядра хранятся в одном адресном пространстве, что ускоряет работу                                                                         |                                                     Необходимость регресса всей системы из-за невозмжности изолирования части системы при локальных изменения кодах, низкая пресказуемость системы                                                     |                  Низкая стоимость разработки, но большие затраты на тестирование и сопровождение системы. Развертывание недорогое, devops не обязателен                  |
| Модульный монолит |               Если одинаковая/схожая функциональность окажется в двух модулях, то потребуется дублировать код. Следовательно его изменения также придется дублировать              |   если код системы организован в четко определенные модули, которые разделяют систему на легко развертываемые подблоки, развертывание будет намного проще.   |       Есть возможность развивать модули независимо друг от друга, но их большой размер может негативно сказаться на возможности эволюционировать      |               Выход из строя модуля не влияет на другие модули. Но т.к. модули достаточно большие, то и объем недоступной функциональности также будет большим              |                            Службы для одного модуля хранятся в одном адресном пространстве. Изолированность по бизнес-логике позволяет уменьшить межмодульное взаиможействие, которое может снизить производительность                           |                                                                                      Тестирование отдельных компонентов намного проще тестирования единой системы                                                                                      |              Стоимость разработки выше, чем монолита, но меньше затраты на тестирование и сопровождение системы. Развертывание недорогое (как и у монолита)              |
|    microkernel    | Использование изолированных плагинов позволяет  облегчить модифицируемость системы, но если потребуется изменение ядра, то это может привести к необходимости дорабатывать плагины |                                    Подход хорошо применим, когда требуется использовать разные плагины в разных условиях                                    |          т.к. ядро имеет только базовую функциональность, то реестр плагинов позволяет эволюционно добавлять/удалять функциональность системы         |                      Если сервис выходит из строя, это влияет на работу микроядра. Но если ядро выйдет из строя, то вся система будет выведена из строя                      | Связь между клиентской программой / приложением и службами, работающими в адресном пространстве пользователя, устанавливается посредством передачи сообщений. Они никогда не взаимодействуют напрямую. Это снижает скорость выполнения микроядра. |                                                              При тестировании отдельного плагина не требуется ретест остальных.  Но при изменении в Core потребуется регресс всей системы                                                              | Стоимость разработки/доработок плагинов относительно низкая, а завтраты на сопровождение и тетсирование ниже, чем у монолита. Развертывание недорогое (как и у монолита) |
|  Service-Oriented |    При изменении отдельного сервиса высока вероятность, что потребуется также изменение общей шины, а она является очень сложной частью системы со своей дополнительной логикой    |                                                          Сложное разворачивание новых версий сервиса                                                         | Команда поддержки Корпоративной шины может не согласовывать новые подходы и улучшения (по личному опыту, там ребята с мнением "работает - не трогай") |                          Выход из строя отдельного сервиса не влияет на остальные, но опроблемы в интеграционной шине повлияют на работу всеё истемы                         |                                                                   Требуется передача данных через общую шину, что снижает производительность системы. Распределенные транзакции                                                                   |               Требуется тестирование не только отдельного сервиса, но и всех его интеграций с другими сервисами и работы корпоративной шины (а это беда). Даже при локальном изменении может потребоваться регресс всего бизнес-процесса              |                                                  Затраты на доработку и сопровождение сервисов, затраты на тестирование                                                  |
|   Service-Based   |             Сервисы слабо связаны, могут иметь отдельный интерфейс. Проблема может возникнуть при доработках общей базы данных, а также перетекании в неё бизнес-логики            |              Сервисы могут быть организованы на различных принципах и при использовании практик devops разворачиваться независимо друг от друга             |                   Независимые сервисы легко могут развиваться независимо друг от друга Бутылочное горлышко при изменении базы данных                  |                                                          Независимые сервисы не приводят к падению других сервисов.                                                          |                                          Вероятность распределенных транзакций. Скорость работы может быть достигнута за счет неактуальности данных.  Возможность использования балансировщиков нагрузки                                          |                                                             Тестрирование сервисов можно производить независимо друг от друга, но при изменении в слое API потребуется регресс всей системы                                                            |                                                          Требуются затраты на интеграцию, сопровождение, devops                                                         |
|    Space-Based    |          В раамках одного сервиса содержится не только бизнес-логика, но и реплика базы данных. Поэтому локальные изменения в одном сервисе никак не повлияют на остальные         |                                    При использовании практик devops сервисы могут разворачиваться независимо друг от друга                                   |                       Независимые сервисы легко могут развиваться независимо друг от друга Сложности при изменении модели данных                      |                                             Независимые сервисы не приводят к падению других сервисов. Высокая отказоустойчивость                                            |                                                                Затраты на передачу сообщений. Балансировка нагрузки и хранение локальных данных может увеличить производительность                                                                |                                                                   Изолированность сервисов позволяет производить их независимое тестирование, но тестирование интеграций требуется                                                                    |                              Высокая стоимость по обеспечению интеграции и специализированного ПО, построения модели данных и их репликации                              |
|    Event-Driven   |                                        Вероятность перетекания бизнес-логики в медиатор, но в остальном изменение таких систем очень простое                                       |                                    При использовании практик devops сервисы могут разворачиваться независимо друг от друга                                   |     Сервисы могут развиваться независимо друг от друга, но при любом эволюционном изменении требуется контролировать интеграцию с другими модулями    | Много независимых компонентов, которые по отдельности показывают высокую отказоустойчивость, но в соввокупности количество точек, где может произойти отказ, увеличивается   |                                                                                       Передача сообщений, возможны потери в скорости обработки на медиаторе/                                                                                      |                                                                               Простое тестирование сервисов, но очень сложное тестирование интеграции и системы в целом                                                                                |                    Высокая стоимость обеспечения систмы, затраты на тестирование, затраты на обязательную стандартизацию взаимодействия между модулями                   |
|   Microservices   |                                    Независимые и изолированные модули с ограниченным контекстом могут легко изменяться независимо друг от друга                                    |                                                             Разворачивание независимых сервисов                                                              |                         Т.к. сервисы изолированы и имеют собственные БД и технологии, то их развитие независимо друг от друга                         |                       Вероятно каскадное отключение сервисов, большое количество интеграций приводит к росту кличества точек, где может произойти отказ                      |                                                                                            Расходы на передачу данных между большим количеством звеньев                                                                                           | Тестирование изолированных модулей достаточно просто, при локальном измении требуется регресс только той части системы, которая выполняет соответствующий бизнес-процесс. Требуется  тестирование под нагрузкой и тестирование отказов в части модулей |       Высокая стоимость организации и обеспечения системы. Требуется доработка многих сервисов из-за дублирования кода, затраты на обеспечение отказоустойчивости       |

## Решение
Использование микросервисной архитектуры
## Статус
Утверждено
## Псоледствия 
* Микросервисы могут обеспечить максимальную гибкость, скорость и масштабируемость. 
* Приложения с экстремальными требованиями лучше всего вписываются именно в микросервисную архитектуру, которая может удовлетворить запросам каждой из служб разрабатываемого приложения.
* Экспертиза в микросервисах: команда, имеющая некоторый опыт работы с микросервисами или распределенным дизайном. 
* Потребуется общее решение для сквозных проблем, таких как логирование, ведение метрик, проверки работоспособности, внешнее конфигурирование. 
* Построение микросервисной архитектуры требует большей нагрузки на развертывание и мониторинг, что напрямую связано с более высокими операционными накладными расходами. 
* Организационные изменения. Каждая команда должна охватить весь жизненный цикл микросервиса, чтобы стать полностью независимой: от дизайна и концепции, технических решений и реализации до текущих операций и мониторинга. Это требует организационных изменений, таких как передача полномочий от менеджеров командам. Культура DevOps, которая также опирается на методы автоматизации, настоятельно рекомендуется для успешной адаптации подхода с использованием микросервисов.
